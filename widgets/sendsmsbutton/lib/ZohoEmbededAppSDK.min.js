var ZOHO=function(){var b,f={};return{embeddedApp:{on:function(d,b){f[d]=b},init:function(){b=new ZSDK;var d,g=new Promise(function(b,c){d=b});b.OnLoad(function(){d()});for(var c in f)b.getContext().Event.Listen(c,f[c]);return g}},CRM:function(){function d(a){return b.getContext().Event.Trigger("CRM_EVENT",a,!0)}function g(a,b,c,e){a={category:"CREATE",Entity:a,RelatedID:c,APIData:b};a.type=e||"RECORD";return d(a)}function c(a,b,c){return d({category:"READ",APIData:{Entity:a,RecordID:b,RelatedList:c}})}
function h(a,b,c){var e=void 0;if("CONNECTOR"!=c){c=b.url;var g=b.params,e=b.headers;b=b.body;if(!c)throw{Message:"Url missing"};if(g){var h,t=[];for(h in g)t.push(encodeURIComponent(h)+"\x3d"+encodeURIComponent(g[h]));h=t.join("\x26");c+=(-1<c.indexOf("?")?"\x26":"?")+h}e={url:c,Header:e,Body:b}}else e=b;return d({category:"CONNECTOR",nameSpace:a,data:e})}function e(a){$.extend(a,{category:"UI"});return d(a)}function k(a,b){return d({category:"CONFIG",type:a,nameSpace:b})}function f(a){var b={category:"USER"};
a.ID?b.ID=a.ID:a.Type&&(b.Type=a.Type);return d(b)}function m(a){a={category:"META",type:a.type,Entity:a.Entity};return d(a)}return{CONFIG:{getOrgVariable:function(a){return k("VARIABLE",a)},getOrgInfo:function(a){return k("ORG")},getCurrentUser:function(){return k("CURRENT_USER").then(function(a){return a[0]})}},META:{API:{getFields:function(a){a.type="FIELD_LIST";return m(a)},getModules:function(){return m({type:"MODULE_LIST"})},getAssignmentRules:function(a){a.type="ASSIGNMENT_RULES";return m(a)}}},
API:{addNotes:function(a){return g(a.Entity,{data:[{Note_Title:a.Title,Note_Content:a.Content}]},a.RecordID,"NOTES")},addNotesAttachment:function(a){return d({category:"UPDATE",type:"NOTES",Entity:a.Entity,RecordID:a.RecordID,RelatedRecordID:a.RelatedRecordID,APIData:{Files:{FileName:File.Name,FileData:File.Content}}})},insertRecord:function(a){return g(a.Entity,a.APIData)},getRecord:function(a){return c(a.Entity,a.RecordID)},getAllRecords:function(a){return d({category:"READ",APIData:a})},updateRecord:function(a){return d({category:"UPDATE",
type:"RECORD",Entity:a.Entity,APIData:a.APIData})},deleteRecord:function(a){return d({category:"DELETE",type:"RECORD",Entity:a.Entity,RecordID:a.RecordID})},searchRecord:function(a){return d({category:"SEARCH",Entity:a.Entity,Type:a.Type,Query:a.Query})},getAllUsers:function(a){return f({Type:a.Type})},getUser:function(a){return f({ID:a.ID})},getAllUsers:function(a){return f({Type:a.Type})},getRelatedRecords:function(a){return c(a.Entity,a.RecordID,a.RelatedList)},updateRelatedRecords:function(a){return d({category:"UPDATE",
type:"RELATED_RECORD",Entity:a.Entity,RecordID:a.RecordID,RelatedList:a.RelatedList,RelatedRecordID:a.RelatedRecordID,APIData:a.APIData})},delinkRelatedRecord:function(a){return d({category:"DELETE",type:"RELATED_RECORD",Entity:a.Entity,RecordID:a.RecordID,RelatedList:a.RelatedList,RelatedRecordID:a.RelatedRecordID})},attachFile:function(a){var b=a.Entity,c=a.RecordID;a=a.File;a={FileName:a.Name,FileData:a.Content};return g(b,a,c,"ATTACHMENT")}},INTERACTION:{getPageInfo:function(){return d({category:"PAGEINFO"})}},
UI:{Dialer:{maximize:function(){return e({action:{telephony:"MAXIMIZE"}})},minimize:function(){return e({action:{telephony:"MINIMIZE"}})},notify:function(){return e({action:{telephony:"NOTIFY"}})},resize:function(a,b){}},Record:{open:function(a){a={action:{record:"OPEN"},data:{Entity:a.Entity,RecordID:a.RecordID}};return e(a)},populate:function(a){return e({action:{record:"POPULATE"},data:a})}},Popup:{close:function(){return e({action:{popup:"CLOSE"}})},closeReload:function(){return e({action:{popup:"CLOSE_RELOAD"}})}}},
HTTP:{get:function(a){return h("wget.get",a)},post:function(a){return h("wget.post",a)}},CONNECTOR:{invokeAPI:function(a,b){return h(a,b,"CONNECTOR")}}}}()}}();var ZSDKUtil=function(b){function f(b){}function d(b){var c={};b=b||window.location.href;b.substr(b.indexOf("?")+1).split("\x26").forEach(function(b,d){var g=b.split("\x3d");c[g[0]]=g[1]});c.hasOwnProperty("serviceOrigin")&&(c.serviceOrigin=decodeURIComponent(c.serviceOrigin));return c}var g=d(),c;f.prototype.Info=function(){(b.isDevMode()||b.isLogEnabled())&&window.console.info.apply(null,arguments)};f.prototype.Error=function(){(b.isDevMode()||b.isLogEnabled())&&window.console.error.apply(null,
arguments)};b.GetQueryParams=d;b.isDevMode=function(){return g&&g.isDevMode};b.isLogEnabled=function(){return g&&g.isLogEnabled};b.getLogger=function(){c&&c instanceof f||(c=new f);return c};b.Sleep=function(b){for(var c=(new Date).getTime();c+b>(new Date).getTime(););};return b}(window.ZSDKUtil||{}),ZSDKMessageManager=function(b){function f(a){try{var b="string"===typeof a.data?JSON.parse(a.data):a.data}catch(e){b=a.data}var u=b.type,l=b.eventName;try{var z;if(!(z="SET_CONTEXT"===l)){var A=a.source,
B=a.origin;z=q&&p===A&&r===B?!0:Error("Un-Authorized Message.")}if(z)switch(u){case "FRAMEWORK.EVENT":var h={SET_CONTEXT:d,UPDATE_CONTEXT:g,EVENT_RESPONSE:c}[b.eventName];h&&"function"===typeof h?h(a,b):ZSDKEventManager.NotifyEventListeners(k.AppContext,b.eventName,b.data);break;case "SDK.CNTR_ACCESS_CODE_RECEIVED":var f=b.code,v=b.error,m=b.state;!f||v&&"undefined"!==v?f&&"undefined"!==f||!v||(n[m]={error:v,error_time:(new Date).getTime()}):n[m]={code:f,access_code_time:(new Date).getTime()};break;
default:k.MessageInterceptor(a,b)}}catch(e){x.Error("[SDK.MessageHandler] \x3d\x3e ",e.stack)}}function d(a,b){var c=a.origin;if(!w.test(c))throw Error("Messsage received from unauthorized domain.");p=a.source;r=c;k.SetContext(b.data);k.ExecuteLoadHandler();q=!0}function g(a,b){}function c(b,c){var d=c.promiseid,g=c.data;a.hasOwnProperty(d)&&(a[d].resolve(g),a[d]=void 0,delete a[d])}function h(b){return new Promise(function(c,d){a[b]={resolve:c,reject:d,time:(new Date).getTime()}})}function e(a){"object"===
typeof a&&(a.appOrigin=encodeURIComponent(window.location.href));if(!p)throw Error("Parentwindow reference not found.");p.postMessage(a,k.QueryParams.serviceOrigin)}var k,x=ZSDKUtil.getLogger(),m=100,a={},w=/^https?:\/\/[a-zA-Z0-9-_]*.(sandbox.crm-oem.com|csez.zohocorpin.com|zoho.com|localzoho.com|zohoplatform.com|localzohoplatform.com|zohosandbox.com|localzohosandbox.com)(:[0-9]{0,4})?$/,q=!1,p,r,n={};b.Init=function(a,c){if(!a||"object"!==typeof a)throw Error("Invalid Context object passed");if(c&&
"object"!==typeof c)throw Error("Invalid Configuration Passed to MessageManager");k=a;return f.bind(b)};b.RegisterApp=function(){var a={type:"SDK.EVENT",eventName:"REGISTER",appOrigin:encodeURIComponent(window.location.href)};window.top.postMessage(a,k.QueryParams.serviceOrigin)};b.DERegisterApp=function(){var a={type:"SDK.EVENT",eventName:"DEREGISTER",uniqueID:k.getUniqueID()};e(a)};b.SendRequest=function(a){if(!a||"object"!==typeof a)throw Error("Invalid Options passed");if(a.connector&&ZSDKUtil.isDevMode()){var b=
k.GetConnectors();return ZSDKAPIHelper.GetRequest(a,b)}b="Promise"+m++;a={type:"SDK.EVENT",eventName:"HTTP_REQUEST",uniqueID:k.getUniqueID(),time:(new Date).getTime(),promiseid:b,data:a};e(a);a=h(b);return a};b.TriggerEvent=function(a,b,c){if(!a)throw Error("Invalid Eventname : ",a);var d=c?"Promise"+m++:void 0;a={type:"SDK.EVENT",eventName:a,uniqueID:k.getUniqueID(),time:(new Date).getTime(),promiseid:d,data:b};e(a);if(c)return h(d)};b.getFetchedAccessCode=function(a){return n[a]};b.UpdateConnectorData=
function(a,b){return new Promise(function(c,d){$.post({url:"http://127.0.0.1:5000/updateconnector",dataType:"json",data:{connectorName:a,connectorData:JSON.stringify(b)}}).then(function(a){c(a)},function(a){d(JSON.parse(a))})})};return b}(window.ZSDKMessageManager||{}),ZSDKEventManager=function(b){var f=ZSDKUtil.getLogger(),d={};b.AttachEventListener=function(b,c){"function"===typeof c&&(Array.isArray(d[b])||(d[b]=[]),d[b].push(c))};b.NotifyEventListeners=function(b,c,h){var e=c.match(/^\__[A-Za-z_]+\__$/gi);
Array.isArray(e);if((e=d[c])&&Array.isArray(e))for(c=0;c<e.length;c++)e[c].call(b,h);else f.Info("Cannot find EventListeners for Event : ",c)};b.NotifyInternalEventHandler=function(b,c){var d=c.eventName;"__APP_INIT__"===d?(b.SetContext(c.data),b.ExecuteLoadHandler()):"__APP_CONTEXT_UPDATE__"===d&&(b.UpdateContext(c.data),b.ExecuteContextUpdateHandler())};return b}(window.ZSDKEventManager||{});
function ZSDK(){function b(){"function"!==typeof q?u.Error("No OnLoad Handler provided to execute."):q.call(l,l)}function f(){p.call(l,l)}function d(a,b,c){return ZSDKMessageManager.TriggerEvent(a,b,c)}function g(a){u.Info("Setting AppContext data");var b=a&&a.model||{};isDevMode&&a.locale&&a.localeResource&&0===Object.keys(a.localeResource).length&&a.localeResource.constructor===Object&&a.locale&&k(a.locale);if("undefined"!==typeof ZSDKModelManager){for(var c in b)ZSDKModelManager.AddModel(c,b[c]);
l.Model=ZSDKModelManager.GetModelStore()}t=a.uniqueID;r=a.connectors;u.Info("App Connectors ",r)}function c(){return t}function h(a){}function e(){return r}function k(a){x("/app-translations/"+a+".json",function(a){y=JSON.parse(a);w()})}function x(a,b){var c=new XMLHttpRequest;c.open("GET",a,!1);c.onreadystatechange=function(){4==c.readyState&&"200"==c.status&&b(c.responseText)};c.send(null)}function m(a,b,c){for(var d="";d!=a;)d=a,a=a.replace(b,c);return a}function a(a,b){b=b.replace(/\[(\w+)\]/g,
".$1");b=b.replace(/^\./,"");for(var c=b.split("."),d=0,e=c.length;d<e;++d){var f=c[d];if(f in a)a=a[f];else return}return a}function w(){var b=document.querySelectorAll("[data-i18n]"),c;for(c in b)if(b.hasOwnProperty(c)){var d=a(y,b[c].getAttribute("data-i18n"));if(!d)return!1;if(b[c].hasAttribute("data-options")){var e=JSON.parse(JSON.stringify(eval("("+b[c].getAttribute("data-options")+")"))),f=Object.keys(e),g;for(g in f)d=m(d,"${"+f[g]+"}",e[f[g]])}b[c].innerHTML=d}}var q,p,r,n,t,y={},u=ZSDKUtil.getLogger();
this.isContextReady=!1;this.HelperContext={};this.isDevMode=!1;this.getContext=function(){return l};var l={Model:{},Event:{}};l.Event.Listen=function(a,b){ZSDKEventManager.AttachEventListener(a,b)};l.Event.Trigger=d;l.GetRequest=function(a){return ZSDKMessageManager.SendRequest(a)};l.QueryParams=n;l.Translate=function(b,c){var d="";b&&(d=a(y,b));if(!d)return!1;if(c){var e=JSON.parse(JSON.stringify(eval(c))),f=Object.keys(e);for(b in f)d=m(d,"${"+f[b]+"}",e[f[b]])}return d};this.OnLoad=function(a){if("function"!==
typeof a)throw Error("Invalid Function value is passed");q=a};this.OnUnLoad=function(a){};this.OnContextUpdate=function(a){p=a};(function(){n=ZSDKUtil.GetQueryParams();isDevMode=!!n.isDevMode;var a={};a.isDevMode=isDevMode;a.ExecuteLoadHandler=b;a.SetContext=g;a.UpdateContext=h;a.QueryParams=n;a.GetConnectors=e;a.TriggerEvent=d;a.ExecuteContextUpdateHandler=f;a.getUniqueID=c;var k=ZSDKMessageManager.Init(a);window.addEventListener("message",k);window.addEventListener("unload",function(){ZSDKMessageManager.DERegisterApp()});
"undefined"!==typeof ZSDKModelManager&&ZSDKModelManager.Init(a);ZSDKMessageManager.RegisterApp()})()};
